// dat.gui.js - http://code.google.com/p/dat-gui/
var dat=dat||{};dat.gui=dat.gui||{};dat.utils=dat.utils||{};dat.controllers=dat.controllers||{};dat.dom=dat.dom||{};dat.color=dat.color||{};dat.utils.css=function(){return{load:function(e,t){t=t||document;var n=t.createElement("link");n.type="text/css";n.rel="stylesheet";n.href=e;t.getElementsByTagName("head")[0].appendChild(n)},inject:function(e,t){t=t||document;var n=document.createElement("style");n.type="text/css";n.innerHTML=e;t.getElementsByTagName("head")[0].appendChild(n)}}}();dat.utils.common=function(){var e=Array.prototype.forEach;var t=Array.prototype.slice;return{BREAK:{},extend:function(e){this.each(t.call(arguments,1),function(t){for(var n in t)if(!this.isUndefined(t[n]))e[n]=t[n]},this);return e},defaults:function(e){this.each(t.call(arguments,1),function(t){for(var n in t)if(this.isUndefined(e[n]))e[n]=t[n]},this);return e},compose:function(){var e=t.call(arguments);return function(){var n=t.call(arguments);for(var r=e.length-1;r>=0;r--){n=[e[r].apply(this,n)]}return n[0]}},each:function(t,n,r){if(!t)return;if(e&&t.forEach&&t.forEach===e){t.forEach(n,r)}else if(t.length===t.length+0){for(var i=0,s=t.length;i<s;i++)if(i in t&&n.call(r,t[i],i)===this.BREAK)return}else{for(var i in t)if(n.call(r,t[i],i)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},toArray:function(e){if(e.toArray)return e.toArray();return t.call(e)},isUndefined:function(e){return e===undefined},isNull:function(e){return e===null},isNaN:function(e){return e!==e},isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===false||e===true},isFunction:function(e){return Object.prototype.toString.call(e)==="[object Function]"}}}();dat.controllers.Controller=function(e){var t=function(e,t){this.initialValue=e[t];this.domElement=document.createElement("div");this.object=e;this.property=t;this.__onChange=undefined;this.__onFinishChange=undefined};e.extend(t.prototype,{onChange:function(e){this.__onChange=e;return this},onFinishChange:function(e){this.__onFinishChange=e;return this},setValue:function(e){this.object[this.property]=e;if(this.__onChange){this.__onChange.call(this,e)}this.updateDisplay();return this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}});return t}(dat.utils.common);dat.dom.dom=function(e){function i(t){if(t==="0"||e.isUndefined(t))return 0;var n=t.match(r);if(!e.isNull(n)){return parseFloat(n[1])}return 0}var t={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]};var n={};e.each(t,function(t,r){e.each(t,function(e){n[e]=r})});var r=/(\d+(\.\d+)?)px/;var s={makeSelectable:function(e,t){if(e===undefined||e.style===undefined)return;e.onselectstart=t?function(){return false}:function(){};e.style.MozUserSelect=t?"auto":"none";e.style.KhtmlUserSelect=t?"auto":"none";e.unselectable=t?"on":"off"},makeFullscreen:function(t,n,r){if(e.isUndefined(n))n=true;if(e.isUndefined(r))r=true;t.style.position="absolute";if(n){t.style.left=0;t.style.right=0}if(r){t.style.top=0;t.style.bottom=0}},fakeEvent:function(t,r,i,s){i=i||{};var o=n[r];if(!o){throw new Error("Event type "+r+" not supported.")}var u=document.createEvent(o);switch(o){case"MouseEvents":var a=i.x||i.clientX||0;var f=i.y||i.clientY||0;u.initMouseEvent(r,i.bubbles||false,i.cancelable||true,window,i.clickCount||1,0,0,a,f,false,false,false,false,0,null);break;case"KeyboardEvents":var l=u.initKeyboardEvent||u.initKeyEvent;e.defaults(i,{cancelable:true,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,keyCode:undefined,charCode:undefined});l(r,i.bubbles||false,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:u.initEvent(r,i.bubbles||false,i.cancelable||true);break}e.defaults(u,s);t.dispatchEvent(u)},bind:function(e,t,n,r){r=r||false;if(e.addEventListener)e.addEventListener(t,n,r);else if(e.attachEvent)e.attachEvent("on"+t,n);return s},unbind:function(e,t,n,r){r=r||false;if(e.removeEventListener)e.removeEventListener(t,n,r);else if(e.detachEvent)e.detachEvent("on"+t,n);return s},addClass:function(e,t){if(e.className===undefined){e.className=t}else if(e.className!==t){var n=e.className.split(/ +/);if(n.indexOf(t)==-1){n.push(t);e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")}}return s},removeClass:function(e,t){if(t){if(e.className===undefined){}else if(e.className===t){e.removeAttribute("class")}else{var n=e.className.split(/ +/);var r=n.indexOf(t);if(r!=-1){n.splice(r,1);e.className=n.join(" ")}}}else{e.className=undefined}return s},hasClass:function(e,t){return(new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)")).test(e.className)||false},getWidth:function(e){var t=getComputedStyle(e);return i(t["border-left-width"])+i(t["border-right-width"])+i(t["padding-left"])+i(t["padding-right"])+i(t["width"])},getHeight:function(e){var t=getComputedStyle(e);return i(t["border-top-width"])+i(t["border-bottom-width"])+i(t["padding-top"])+i(t["padding-bottom"])+i(t["height"])},getOffset:function(e){var t={left:0,top:0};if(e.offsetParent){do{t.left+=e.offsetLeft;t.top+=e.offsetTop}while(e=e.offsetParent)}return t},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}};return s}(dat.utils.common);dat.controllers.OptionController=function(e,t,n){var r=function(e,i,s){r.superclass.call(this,e,i);var o=this;this.__select=document.createElement("select");if(n.isArray(s)){var u={};n.each(s,function(e){u[e]=e});s=u}n.each(s,function(e,t){var n=document.createElement("option");n.innerHTML=t;n.setAttribute("value",e);o.__select.appendChild(n)});this.updateDisplay();t.bind(this.__select,"change",function(){var e=this.options[this.selectedIndex].value;o.setValue(e)});this.domElement.appendChild(this.__select)};r.superclass=e;n.extend(r.prototype,e.prototype,{setValue:function(e){var t=r.superclass.prototype.setValue.call(this,e);if(this.__onFinishChange){this.__onFinishChange.call(this,this.getValue())}return t},updateDisplay:function(){this.__select.value=this.getValue();return r.superclass.prototype.updateDisplay.call(this)}});return r}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);dat.controllers.NumberController=function(e,t){function r(e){e=e.toString();if(e.indexOf(".")>-1){return e.length-e.indexOf(".")-1}else{return 0}}var n=function(e,i,s){n.superclass.call(this,e,i);s=s||{};this.__min=s.min;this.__max=s.max;this.__step=s.step;if(t.isUndefined(this.__step)){if(this.initialValue==0){this.__impliedStep=1}else{this.__impliedStep=Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10}}else{this.__impliedStep=this.__step}this.__precision=r(this.__impliedStep)};n.superclass=e;t.extend(n.prototype,e.prototype,{setValue:function(e){if(this.__min!==undefined&&e<this.__min){e=this.__min}else if(this.__max!==undefined&&e>this.__max){e=this.__max}if(this.__step!==undefined&&e%this.__step!=0){e=Math.round(e/this.__step)*this.__step}return n.superclass.prototype.setValue.call(this,e)},min:function(e){this.__min=e;return this},max:function(e){this.__max=e;return this},step:function(e){this.__step=e;this.__impliedStep=e;this.__precision=r(e);return this}});return n}(dat.controllers.Controller,dat.utils.common);dat.controllers.NumberControllerBox=function(e,t,n){function i(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}var r=function(e,i,s){function a(){var e=parseFloat(o.__input.value);if(!n.isNaN(e))o.setValue(e)}function f(){a();if(o.__onFinishChange){o.__onFinishChange.call(o,o.getValue())}}function l(e){t.bind(window,"mousemove",c);t.bind(window,"mouseup",h);u=e.clientY}function c(e){var t=u-e.clientY;o.setValue(o.getValue()+t*o.__impliedStep);u=e.clientY}function h(){t.unbind(window,"mousemove",c);t.unbind(window,"mouseup",h)}this.__truncationSuspended=false;r.superclass.call(this,e,i,s);var o=this;var u;this.__input=document.createElement("input");this.__input.setAttribute("type","text");t.bind(this.__input,"change",a);t.bind(this.__input,"blur",f);t.bind(this.__input,"mousedown",l);t.bind(this.__input,"keydown",function(e){if(e.keyCode===13){o.__truncationSuspended=true;this.blur();o.__truncationSuspended=false}});this.updateDisplay();this.domElement.appendChild(this.__input)};r.superclass=e;n.extend(r.prototype,e.prototype,{updateDisplay:function(){this.__input.value=this.__truncationSuspended?this.getValue():i(this.getValue(),this.__precision);return r.superclass.prototype.updateDisplay.call(this)}});return r}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common);dat.controllers.NumberControllerSlider=function(e,t,n,r,i){function o(e,t,n,r,i){return r+(i-r)*((e-t)/(n-t))}var s=function(e,n,r,i,u){function f(e){t.bind(window,"mousemove",l);t.bind(window,"mouseup",c);l(e)}function l(e){e.preventDefault();var n=t.getOffset(a.__background);var r=t.getWidth(a.__background);a.setValue(o(e.clientX,n.left,n.left+r,a.__min,a.__max));return false}function c(){t.unbind(window,"mousemove",l);t.unbind(window,"mouseup",c);if(a.__onFinishChange){a.__onFinishChange.call(a,a.getValue())}}s.superclass.call(this,e,n,{min:r,max:i,step:u});var a=this;this.__background=document.createElement("div");this.__foreground=document.createElement("div");t.bind(this.__background,"mousedown",f);t.addClass(this.__background,"slider");t.addClass(this.__foreground,"slider-fg");this.updateDisplay();this.__background.appendChild(this.__foreground);this.domElement.appendChild(this.__background)};s.superclass=e;s.useDefaultStyles=function(){n.inject(i)};r.extend(s.prototype,e.prototype,{updateDisplay:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);this.__foreground.style.width=e*100+"%";return s.superclass.prototype.updateDisplay.call(this)}});return s}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,"/**\n * dat-gui JavaScript Controller Library\n * http://code.google.com/p/dat-gui\n *\n * Copyright 2011 Data Arts Team, Google Creative Lab\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n */\n\n.slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}");dat.controllers.FunctionController=function(e,t,n){var r=function(e,n,i){r.superclass.call(this,e,n);var s=this;this.__button=document.createElement("div");this.__button.innerHTML=i===undefined?"Fire":i;t.bind(this.__button,"click",function(e){e.preventDefault();s.fire();return false});t.addClass(this.__button,"button");this.domElement.appendChild(this.__button)};r.superclass=e;n.extend(r.prototype,e.prototype,{fire:function(){if(this.__onChange){this.__onChange.call(this)}if(this.__onFinishChange){this.__onFinishChange.call(this,this.getValue())}this.getValue().call(this.object)}});return r}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);dat.controllers.BooleanController=function(e,t,n){var r=function(e,n){function s(){i.setValue(!i.__prev)}r.superclass.call(this,e,n);var i=this;this.__prev=this.getValue();this.__checkbox=document.createElement("input");this.__checkbox.setAttribute("type","checkbox");t.bind(this.__checkbox,"change",s,false);this.domElement.appendChild(this.__checkbox);this.updateDisplay()};r.superclass=e;n.extend(r.prototype,e.prototype,{setValue:function(e){var t=r.superclass.prototype.setValue.call(this,e);if(this.__onFinishChange){this.__onFinishChange.call(this,this.getValue())}this.__prev=this.getValue();return t},updateDisplay:function(){if(this.getValue()===true){this.__checkbox.setAttribute("checked","checked");this.__checkbox.checked=true}else{this.__checkbox.checked=false}return r.superclass.prototype.updateDisplay.call(this)}});return r}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);dat.color.toString=function(e){return function(t){if(t.a==1||e.isUndefined(t.a)){var n=t.hex.toString(16);while(n.length<6){n="0"+n}return"#"+n}else{return"rgba("+Math.round(t.r)+","+Math.round(t.g)+","+Math.round(t.b)+","+t.a+")"}}}(dat.utils.common);dat.color.interpret=function(e,t){var n,r;var i=function(){r=false;var e=arguments.length>1?t.toArray(arguments):arguments[0];t.each(s,function(i){if(i.litmus(e)){t.each(i.conversions,function(i,s){n=i.read(e);if(r===false&&n!==false){r=n;n.conversionName=s;n.conversion=i;return t.BREAK}});return t.BREAK}});return r};var s=[{litmus:t.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);if(t===null)return false;return{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString())}},write:e},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);if(t===null)return false;return{space:"HEX",hex:parseInt("0x"+t[1].toString())}},write:e},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);if(t===null)return false;return{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:e},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);if(t===null)return false;return{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:e}}},{litmus:t.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:t.isArray,conversions:{RGB_ARRAY:{read:function(e){if(e.length!=3)return false;return{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){if(e.length!=4)return false;return{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:t.isObject,conversions:{RGBA_OBJ:{read:function(e){if(t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)&&t.isNumber(e.a)){return{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}}return false},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){if(t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)){return{space:"RGB",r:e.r,g:e.g,b:e.b}}return false},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){if(t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)&&t.isNumber(e.a)){return{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}}return false},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){if(t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)){return{space:"HSV",h:e.h,s:e.s,v:e.v}}return false},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}];return i}(dat.color.toString,dat.utils.common);dat.GUI=dat.gui.GUI=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){function C(e,t,n,s){if(t[n]===undefined){throw new Error("Object "+t+' has no property "'+n+'"')}var o;if(s.color){o=new l(t,n)}else{var u=[t,n].concat(s.factoryArgs);o=r.apply(e,u)}if(s.before instanceof i){s.before=s.before.__li}A(e,o);p.addClass(o.domElement,"c");var a=document.createElement("span");p.addClass(a,"property-name");a.innerHTML=o.property;var f=document.createElement("div");f.appendChild(a);f.appendChild(o.domElement);var c=k(e,f,s.before);p.addClass(c,N.CLASS_CONTROLLER_ROW);p.addClass(c,typeof o.getValue());L(e,c,o);e.__controllers.push(o);return o}function k(e,t,n){var r=document.createElement("li");if(t)r.appendChild(t);if(n){e.__ul.insertBefore(r,params.before)}else{e.__ul.appendChild(r)}e.onResize();return r}function L(e,t,n){n.__li=t;n.__gui=e;d.extend(n,{options:function(t){if(arguments.length>1){n.remove();return C(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[d.toArray(arguments)]})}if(d.isArray(t)||d.isObject(t)){n.remove();return C(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[t]})}},name:function(e){n.__li.firstElementChild.firstElementChild.innerHTML=e;return n},listen:function(){n.__gui.listen(n);return n},remove:function(){n.__gui.remove(n);return n}});if(n instanceof a){var r=new u(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});d.each(["updateDisplay","onChange","onFinishChange"],function(e){var t=n[e];var i=r[e];n[e]=r[e]=function(){var e=Array.prototype.slice.call(arguments);t.apply(n,e);return i.apply(r,e)}});p.addClass(t,"has-slider");n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof u){var i=function(t){if(d.isNumber(n.__min)&&d.isNumber(n.__max)){n.remove();return C(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]})}return t};n.min=d.compose(i,n.min);n.max=d.compose(i,n.max)}else if(n instanceof s){p.bind(t,"click",function(){p.fakeEvent(n.__checkbox,"click")});p.bind(n.__checkbox,"click",function(e){e.stopPropagation()})}else if(n instanceof o){p.bind(t,"click",function(){p.fakeEvent(n.__button,"click")});p.bind(t,"mouseover",function(){p.addClass(n.__button,"hover")});p.bind(t,"mouseout",function(){p.removeClass(n.__button,"hover")})}else if(n instanceof l){p.addClass(t,"color");n.updateDisplay=d.compose(function(e){t.style.borderLeftColor=n.__color.toString();return e},n.updateDisplay);n.updateDisplay()}n.setValue=d.compose(function(t){if(e.getRoot().__preset_select&&n.isModified()){j(e.getRoot(),true)}return t},n.setValue)}function A(e,t){var n=e.getRoot();var r=n.__rememberedObjects.indexOf(t.object);if(r!=-1){var i=n.__rememberedObjectIndecesToControllers[r];if(i===undefined){i={};n.__rememberedObjectIndecesToControllers[r]=i}i[t.property]=t;if(n.load&&n.load.remembered){var s=n.load.remembered;var o;if(s[e.preset]){o=s[e.preset]}else if(s[y]){o=s[y]}else{return}if(o[r]&&o[r][t.property]!==undefined){var u=o[r][t.property];t.initialValue=u;t.setValue(u)}}}}function O(e,t){return document.location.href+"."+t}function M(e){var t=e.__save_row=document.createElement("li");p.addClass(e.domElement,"has-save");e.__ul.insertBefore(t,e.__ul.firstChild);p.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;";p.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save";p.addClass(r,"button");p.addClass(r,"save");var i=document.createElement("span");i.innerHTML="New";p.addClass(i,"button");p.addClass(i,"save-as");var s=document.createElement("span");s.innerHTML="Revert";p.addClass(s,"button");p.addClass(s,"revert");var o=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered){d.each(e.load.remembered,function(t,n){H(e,n,n==e.preset)})}else{H(e,y,false)}p.bind(o,"change",function(){for(var t=0;t<e.__preset_select.length;t++){e.__preset_select[t].innerHTML=e.__preset_select[t].value}e.preset=this.value});t.appendChild(o);t.appendChild(n);t.appendChild(r);t.appendChild(i);t.appendChild(s);if(b){var u=document.getElementById("dg-save-locally");var a=document.getElementById("dg-local-explain");u.style.display="block";var f=document.getElementById("dg-local-storage");if(localStorage.getItem(O(e,"isLocal"))==="true"){f.setAttribute("checked","checked")}function l(){a.style.display=e.useLocalStorage?"block":"none"}l();p.bind(f,"change",function(){e.useLocalStorage=!e.useLocalStorage;l()})}var c=document.getElementById("dg-new-constructor");p.bind(c,"keydown",function(e){if(e.metaKey&&(e.which===67||e.keyCode==67)){w.hide()}});p.bind(n,"click",function(){c.innerHTML=JSON.stringify(e.getSaveObject(),undefined,2);w.show();c.focus();c.select()});p.bind(r,"click",function(){e.save()});p.bind(i,"click",function(){var t=prompt("Enter a new preset name.");if(t)e.saveAs(t)});p.bind(s,"click",function(){e.revert()})}function _(e){function n(n){n.preventDefault();t=n.clientX;p.addClass(e.__closeButton,N.CLASS_DRAG);p.bind(window,"mousemove",r);p.bind(window,"mouseup",i);return false}function r(n){n.preventDefault();e.width+=t-n.clientX;e.onResize();t=n.clientX;return false}function i(){p.removeClass(e.__closeButton,N.CLASS_DRAG);p.unbind(window,"mousemove",r);p.unbind(window,"mouseup",i)}e.__resize_handle=document.createElement("div");d.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var t;p.bind(e.__resize_handle,"mousedown",n);p.bind(e.__closeButton,"mousedown",n);e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function D(e,t){e.domElement.style.width=t+"px";if(e.__save_row&&e.autoPlace){e.__save_row.style.width=t+"px"}if(e.__closeButton){e.__closeButton.style.width=t+"px"}}function P(e,t){var n={};d.each(e.__rememberedObjects,function(r,i){var s={};var o=e.__rememberedObjectIndecesToControllers[i];d.each(o,function(e,n){s[n]=t?e.initialValue:e.getValue()});n[i]=s});return n}function H(e,t,n){var r=document.createElement("option");r.innerHTML=t;r.value=t;e.__preset_select.appendChild(r);if(n){e.__preset_select.selectedIndex=e.__preset_select.length-1}}function B(e){for(var t=0;t<e.__preset_select.length;t++){if(e.__preset_select[t].value==e.preset){e.__preset_select.selectedIndex=t}}}function j(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];if(t){n.innerHTML=n.value+"*"}else{n.innerHTML=n.value}}function F(e){if(e.length!=0){c(function(){F(e)})}d.each(e,function(e){e.updateDisplay()})}e.inject(n);var v="dg";var m=72;var g=20;var y="Default";var b=function(){try{return"localStorage"in window&&window["localStorage"]!==null}catch(e){return false}}();var w;var E=true;var S;var x=false;var T=[];var N=function(e){function f(){var e=t.getRoot();e.width+=1;d.defer(function(){e.width-=1})}var t=this;this.domElement=document.createElement("div");this.__ul=document.createElement("ul");this.domElement.appendChild(this.__ul);p.addClass(this.domElement,v);this.__folders={};this.__controllers=[];this.__rememberedObjects=[];this.__rememberedObjectIndecesToControllers=[];this.__listening=[];e=e||{};e=d.defaults(e,{autoPlace:true,width:N.DEFAULT_WIDTH});e=d.defaults(e,{resizable:e.autoPlace,hideable:e.autoPlace});if(!d.isUndefined(e.load)){if(e.preset)e.load.preset=e.preset}else{e.load={preset:y}}if(d.isUndefined(e.parent)&&e.hideable){T.push(this)}e.resizable=d.isUndefined(e.parent)&&e.resizable;if(e.autoPlace&&d.isUndefined(e.scrollable)){e.scrollable=true}var n=b&&localStorage.getItem(O(this,"isLocal"))==="true";var r;Object.defineProperties(this,{parent:{get:function(){return e.parent}},scrollable:{get:function(){return e.scrollable}},autoPlace:{get:function(){return e.autoPlace}},preset:{get:function(){if(t.parent){return t.getRoot().preset}else{return e.load.preset}},set:function(n){if(t.parent){t.getRoot().preset=n}else{e.load.preset=n}B(this);t.revert()}},width:{get:function(){return e.width},set:function(n){e.width=n;D(t,n)}},name:{get:function(){return e.name},set:function(t){e.name=t;if(s){s.innerHTML=e.name}}},closed:{get:function(){return e.closed},set:function(n){e.closed=n;if(e.closed){p.addClass(t.__ul,N.CLASS_CLOSED)}else{p.removeClass(t.__ul,N.CLASS_CLOSED)}this.onResize();if(t.__closeButton){t.__closeButton.innerHTML=n?N.TEXT_OPEN:N.TEXT_CLOSED;if(e.closed){p.addClass(t.__closeButton,N.CLASS_CLOSED)}else{p.removeClass(t.__closeButton,N.CLASS_CLOSED)}}}},load:{get:function(){return e.load}},useLocalStorage:{get:function(){return n},set:function(e){if(b){n=e;if(e){p.bind(window,"unload",r)}else{p.unbind(window,"unload",r)}localStorage.setItem(O(t,"isLocal"),e)}}}});if(d.isUndefined(e.parent)){e.closed=false;p.addClass(this.domElement,N.CLASS_MAIN);p.makeSelectable(this.domElement,false);if(b){if(n){t.useLocalStorage=true;var i=localStorage.getItem(O(this,"gui"));if(i){e.load=JSON.parse(i)}}}this.__closeButton=document.createElement("button");this.__closeButton.innerHTML=N.TEXT_CLOSED;p.addClass(this.__closeButton,N.CLASS_CLOSE_BUTTON);this.domElement.appendChild(this.__closeButton);p.bind(this.__closeButton,"click",function(){t.closed=!t.closed})}else{if(e.closed===undefined){e.closed=true}var s=document.createTextNode(e.name);p.addClass(s,"controller-name");var o=k(t,s);var u=function(e){e.preventDefault();t.closed=!t.closed;return false};p.addClass(this.__ul,N.CLASS_CLOSED);p.addClass(o,"title");p.bind(o,"click",u);if(!e.closed){this.closed=false}}if(e.autoPlace){if(d.isUndefined(e.parent)){if(E){S=document.createElement("div");p.addClass(S,v);p.addClass(S,N.CLASS_AUTO_PLACE_CONTAINER);document.body.appendChild(S);E=false}S.appendChild(this.domElement);p.addClass(this.domElement,N.CLASS_AUTO_PLACE)}if(!this.parent)D(t,e.width)}p.bind(window,"resize",function(){t.onResize()});p.bind(this.__ul,"webkitTransitionEnd",function(){t.onResize()});p.bind(this.__ul,"transitionend",function(){t.onResize()});p.bind(this.__ul,"oTransitionEnd",function(){t.onResize()});this.onResize();if(e.resizable){_(this)}r=function(){if(b&&localStorage.getItem(O(t,"isLocal"))==="true"){localStorage.setItem(O(t,"gui"),JSON.stringify(t.getSaveObject()))}};this.saveToLocalStorageIfPossible=r;var a=t.getRoot();if(!e.parent){f()}};N.toggleHide=function(){x=!x;d.each(T,function(e){e.domElement.style.zIndex=x?-999:999;e.domElement.style.opacity=x?0:1})};N.CLASS_AUTO_PLACE="a";N.CLASS_AUTO_PLACE_CONTAINER="ac";N.CLASS_MAIN="main";N.CLASS_CONTROLLER_ROW="cr";N.CLASS_TOO_TALL="taller-than-window";N.CLASS_CLOSED="closed";N.CLASS_CLOSE_BUTTON="close-button";N.CLASS_DRAG="drag";N.DEFAULT_WIDTH=245;N.TEXT_CLOSED="Menu";N.TEXT_OPEN="Menu";p.bind(window,"keydown",function(e){if(document.activeElement.type!=="text"&&(e.which===m||e.keyCode==m)){N.toggleHide()}},false);d.extend(N.prototype,{add:function(e,t){return C(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return C(this,e,t,{color:true})},remove:function(e){this.__ul.removeChild(e.__li);this.__controllers.slice(this.__controllers.indexOf(e),1);var t=this;d.defer(function(){t.onResize()})},destroy:function(){if(this.autoPlace){S.removeChild(this.domElement)}},addFolder:function(e){if(this.__folders[e]!==undefined){throw new Error("You already have a folder in this GUI by the"+' name "'+e+'"')}var t={name:e,parent:this};t.autoPlace=this.autoPlace;if(this.load&&this.load.folders&&this.load.folders[e]){t.closed=this.load.folders[e].closed;t.load=this.load.folders[e]}var n=new N(t);this.__folders[e]=n;var r=k(this,n.domElement);p.addClass(r,"folder");return n},open:function(){this.closed=false},close:function(){this.closed=true},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=p.getOffset(e.__ul).top;var n=0;d.each(e.__ul.childNodes,function(t){if(!(e.autoPlace&&t===e.__save_row))n+=p.getHeight(t)});if(window.innerHeight-t-g<n){p.addClass(e.domElement,N.CLASS_TOO_TALL);e.__ul.style.height=window.innerHeight-t-g+"px"}else{p.removeClass(e.domElement,N.CLASS_TOO_TALL);e.__ul.style.height="auto"}}if(e.__resize_handle){d.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"})}if(e.__closeButton){e.__closeButton.style.width=e.width+"px"}},remember:function(){if(d.isUndefined(w)){w=new h;w.domElement.innerHTML=t}if(this.parent){throw new Error("You can only call remember on a top level GUI.")}var e=this;d.each(Array.prototype.slice.call(arguments),function(t){if(e.__rememberedObjects.length==0){M(e)}if(e.__rememberedObjects.indexOf(t)==-1){e.__rememberedObjects.push(t)}});if(this.autoPlace){D(this,this.width)}},getRoot:function(){var e=this;while(e.parent){e=e.parent}return e},getSaveObject:function(){var e=this.load;e.closed=this.closed;if(this.__rememberedObjects.length>0){e.preset=this.preset;if(!e.remembered){e.remembered={}}e.remembered[this.preset]=P(this)}e.folders={};d.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()});return e},save:function(){if(!this.load.remembered){this.load.remembered={}}this.load.remembered[this.preset]=P(this);j(this,false);this.saveToLocalStorageIfPossible()},saveAs:function(e){if(!this.load.remembered){this.load.remembered={};this.load.remembered[y]=P(this,true)}this.load.remembered[e]=P(this);this.preset=e;H(this,e,true);this.saveToLocalStorageIfPossible()},revert:function(e){d.each(this.__controllers,function(t){if(!this.getRoot().load.remembered){t.setValue(t.initialValue)}else{A(e||this.getRoot(),t)}},this);d.each(this.__folders,function(e){e.revert(e)});if(!e){j(this.getRoot(),false)}},listen:function(e){var t=this.__listening.length==0;this.__listening.push(e);if(t)F(this.__listening)}});return N}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',".dg {\n  /** Clear list styles */\n  /* Auto-place container */\n  /* Auto-placed GUI's */\n  /* Line items that don't contain folders. */\n  /** Folder names */\n  /** Hides closed items */\n  /** Controller row */\n  /** Name-half (left) */\n  /** Controller-half (right) */\n  /** Controller placement */\n  /** Shorter number boxes when slider is present. */\n  /** Ensure the entire boolean and function row shows a hand */ }\n  .dg ul {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n    width: 100%;\n    clear: both; }\n  .dg.ac {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 0;\n    z-index: 0; }\n  .dg:not(.ac) .main {\n    /** Exclude mains in ac so that we don't hide close button */\n    overflow: hidden; }\n  .dg.main {\n    -webkit-transition: opacity 0.1s linear;\n    -o-transition: opacity 0.1s linear;\n    -moz-transition: opacity 0.1s linear;\n    transition: opacity 0.1s linear; }\n    .dg.main.taller-than-window {\n      overflow-y: auto; }\n      .dg.main.taller-than-window .close-button {\n        opacity: 1;\n        /* TODO, these are style notes */\n        margin-top: -1px;\n        border-top: 1px solid #2c2c2c; }\n    .dg.main ul.closed .close-button {\n      opacity: 1 !important; }\n    .dg.main:hover .close-button,\n    .dg.main .close-button.drag {\n      opacity: 1; }\n    .dg.main .close-button {\n      /*opacity: 0;*/\n      -webkit-transition: opacity 0.1s linear;\n      -o-transition: opacity 0.1s linear;\n      -moz-transition: opacity 0.1s linear;\n      transition: opacity 0.1s linear;\n      border: 0;\n      position: absolute;\n      line-height: 19px;\n      height: 20px;\n      /* TODO, these are style notes */\n      cursor: pointer;\n      text-align: center;\n      background-color: #000; }\n      .dg.main .close-button:hover {\n        background-color: #111; }\n  .dg.a {\n    float: right;\n    margin-right: 15px;\n    overflow-x: hidden; }\n    .dg.a.has-save > ul {\n      margin-top: 27px; }\n      .dg.a.has-save > ul.closed {\n        margin-top: 0; }\n    .dg.a .save-row {\n      position: fixed;\n      top: 0;\n      z-index: 1002; }\n  .dg li {\n    -webkit-transition: height 0.1s ease-out;\n    -o-transition: height 0.1s ease-out;\n    -moz-transition: height 0.1s ease-out;\n    transition: height 0.1s ease-out; }\n  .dg li:not(.folder) {\n    cursor: auto;\n    height: 27px;\n    line-height: 27px;\n    overflow: hidden;\n    padding: 0 4px 0 5px; }\n  .dg li.folder {\n    padding: 0;\n    border-left: 4px solid rgba(0, 0, 0, 0); }\n  .dg li.title {\n    cursor: pointer;\n    margin-left: -4px; }\n  .dg .closed li:not(.title),\n  .dg .closed ul li,\n  .dg .closed ul li > * {\n    height: 0;\n    overflow: hidden;\n    border: 0; }\n  .dg .cr {\n    clear: both;\n    padding-left: 3px;\n    height: 27px; }\n  .dg .property-name {\n    cursor: default;\n    float: left;\n    clear: left;\n    width: 40%;\n    overflow: hidden;\n    text-overflow: ellipsis; }\n  .dg .c {\n    float: left;\n    width: 60%; }\n  .dg .c input[type=text] {\n    border: 0;\n    margin-top: 4px;\n    padding: 3px;\n    width: 100%;\n    float: right; }\n  .dg .has-slider input[type=text] {\n    width: 30%;\n    /*display: none;*/\n    margin-left: 0; }\n  .dg .slider {\n    float: left;\n    width: 66%;\n    margin-left: -5px;\n    margin-right: 0;\n    height: 19px;\n    margin-top: 4px; }\n  .dg .slider-fg {\n    height: 100%; }\n  .dg .c input[type=checkbox] {\n    margin-top: 9px; }\n  .dg .c select {\n    margin-top: 5px; }\n  .dg .cr.function,\n  .dg .cr.function .property-name,\n  .dg .cr.function *,\n  .dg .cr.boolean,\n  .dg .cr.boolean * {\n    cursor: pointer; }\n  .dg .selector {\n    display: none;\n    position: absolute;\n    margin-left: -9px;\n    margin-top: 23px;\n    z-index: 10; }\n  .dg .c:hover .selector,\n  .dg .selector.drag {\n    display: block; }\n  .dg li.save-row {\n    padding: 0; }\n    .dg li.save-row .button {\n      display: inline-block;\n      padding: 0px 6px; }\n  .dg.dialogue {\n    background-color: #222;\n    width: 460px;\n    padding: 15px;\n    font-size: 13px;\n    line-height: 15px; }\n\n/* TODO Separate style and structure */\n#dg-new-constructor {\n  padding: 10px;\n  color: #222;\n  font-family: Monaco, monospace;\n  font-size: 10px;\n  border: 0;\n  resize: none;\n  box-shadow: inset 1px 1px 1px #888;\n  word-wrap: break-word;\n  margin: 12px 0;\n  display: block;\n  width: 440px;\n  overflow-y: scroll;\n  height: 100px;\n  position: relative; }\n\n#dg-local-explain {\n  display: none;\n  font-size: 11px;\n  line-height: 17px;\n  border-radius: 3px;\n  background-color: #333;\n  padding: 8px;\n  margin-top: 10px; }\n  #dg-local-explain code {\n    font-size: 10px; }\n\n#dat-gui-save-locally {\n  display: none; }\n\n/** Main type */\n.dg {\n  color: #eee;\n  font: 11px 'Lucida Grande', sans-serif;\n  text-shadow: 0 -1px 0 #111;\n  /** Auto place */\n  /* Controller row, <li> */\n  /** Controllers */ }\n  .dg.main {\n    /** Scrollbar */ }\n    .dg.main::-webkit-scrollbar {\n      width: 5px;\n      background: #1a1a1a; }\n    .dg.main::-webkit-scrollbar-corner {\n      height: 0;\n      display: none; }\n    .dg.main::-webkit-scrollbar-thumb {\n      border-radius: 5px;\n      background: #676767; }\n  .dg li:not(.folder) {\n    background: #1a1a1a;\n    border-bottom: 1px solid #2c2c2c; }\n  .dg li.save-row {\n    line-height: 25px;\n    background: #dad5cb;\n    border: 0; }\n    .dg li.save-row select {\n      margin-left: 5px;\n      width: 108px; }\n    .dg li.save-row .button {\n      margin-left: 5px;\n      margin-top: 1px;\n      border-radius: 2px;\n      font-size: 9px;\n      line-height: 7px;\n      padding: 4px 4px 5px 4px;\n      background: #c5bdad;\n      color: #fff;\n      text-shadow: 0 1px 0 #b0a58f;\n      box-shadow: 0 -1px 0 #b0a58f;\n      cursor: pointer; }\n      .dg li.save-row .button.gears {\n        background: #c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;\n        height: 7px;\n        width: 8px; }\n      .dg li.save-row .button:hover {\n        background-color: #bab19e;\n        box-shadow: 0 -1px 0 #b0a58f; }\n  .dg li.folder {\n    border-bottom: 0; }\n  .dg li.title {\n    padding-left: 16px;\n    background: black url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;\n    cursor: pointer;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.2); }\n  .dg .closed li.title {\n    background-image: url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==); }\n  .dg .cr.boolean {\n    border-left: 3px solid #806787; }\n  .dg .cr.function {\n    border-left: 3px solid #e61d5f; }\n  .dg .cr.number {\n    border-left: 3px solid #2fa1d6; }\n    .dg .cr.number input[type=text] {\n      color: #2fa1d6; }\n  .dg .cr.string {\n    border-left: 3px solid #1ed36f; }\n    .dg .cr.string input[type=text] {\n      color: #1ed36f; }\n  .dg .cr.function:hover, .dg .cr.boolean:hover {\n    background: #111; }\n  .dg .c input[type=text] {\n    background: #303030;\n    outline: none; }\n    .dg .c input[type=text]:hover {\n      background: #3c3c3c; }\n    .dg .c input[type=text]:focus {\n      background: #494949;\n      color: #fff; }\n  .dg .c .slider {\n    background: #303030;\n    cursor: ew-resize; }\n  .dg .c .slider-fg {\n    background: #2fa1d6; }\n  .dg .c .slider:hover {\n    background: #3c3c3c; }\n    .dg .c .slider:hover .slider-fg {\n      background: #44abda; }\n",dat.controllers.factory=function(e,t,n,r,i,s,o){return function(u,a){var f=u[a];if(o.isArray(arguments[2])||o.isObject(arguments[2])){return new e(u,a,arguments[2])}if(o.isNumber(f)){if(o.isNumber(arguments[2])&&o.isNumber(arguments[3])){return new n(u,a,arguments[2],arguments[3])}else{return new t(u,a,{min:arguments[2],max:arguments[3]})}}if(o.isString(f)){return new r(u,a)}if(o.isFunction(f)){return new i(u,a,"")}if(o.isBoolean(f)){return new s(u,a)}}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(e,t,n){var r=function(e,n){function s(){i.setValue(i.__input.value)}function o(){if(i.__onFinishChange){i.__onFinishChange.call(i,i.getValue())}}r.superclass.call(this,e,n);var i=this;this.__input=document.createElement("input");this.__input.setAttribute("type","text");t.bind(this.__input,"keyup",s);t.bind(this.__input,"change",s);t.bind(this.__input,"blur",o);t.bind(this.__input,"keydown",function(e){if(e.keyCode===13){this.blur()}});this.updateDisplay();this.domElement.appendChild(this.__input)};r.superclass=e;n.extend(r.prototype,e.prototype,{updateDisplay:function(){if(!t.isActive(this.__input)){this.__input.value=this.getValue()}return r.superclass.prototype.updateDisplay.call(this)}});return r}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,dat.controllers.ColorController=function(e,t,n,r,i){function u(e,t,n,r){e.style.background="";i.each(o,function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+n+" 0%, "+r+" 100%); "})}function a(e){e.style.background="";e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);";e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var s=function(e,o){function c(e){v(e);t.bind(window,"mousemove",v);t.bind(window,"mouseup",h)}function h(){t.unbind(window,"mousemove",v);t.unbind(window,"mouseup",h)}function p(){var e=r(this.value);if(e!==false){f.__color.__state=e;f.setValue(f.__color.toOriginal())}else{this.value=f.__color.toString()}}function d(){t.unbind(window,"mousemove",m);t.unbind(window,"mouseup",d)}function v(e){e.preventDefault();var n=t.getWidth(f.__saturation_field);var r=t.getOffset(f.__saturation_field);var i=(e.clientX-r.left+document.body.scrollLeft)/n;var s=1-(e.clientY-r.top+document.body.scrollTop)/n;if(s>1)s=1;else if(s<0)s=0;if(i>1)i=1;else if(i<0)i=0;f.__color.v=s;f.__color.s=i;f.setValue(f.__color.toOriginal());return false}function m(e){e.preventDefault();var n=t.getHeight(f.__hue_field);var r=t.getOffset(f.__hue_field);var i=1-(e.clientY-r.top+document.body.scrollTop)/n;if(i>1)i=1;else if(i<0)i=0;f.__color.h=i*360;f.setValue(f.__color.toOriginal());return false}s.superclass.call(this,e,o);this.__color=new n(this.getValue());this.__temp=new n(0);var f=this;this.domElement=document.createElement("div");t.makeSelectable(this.domElement,false);this.__selector=document.createElement("div");this.__selector.className="selector";this.__saturation_field=document.createElement("div");this.__saturation_field.className="saturation-field";this.__field_knob=document.createElement("div");this.__field_knob.className="field-knob";this.__field_knob_border="2px solid ";this.__hue_knob=document.createElement("div");this.__hue_knob.className="hue-knob";this.__hue_field=document.createElement("div");this.__hue_field.className="hue-field";this.__input=document.createElement("input");this.__input.type="text";this.__input_textShadow="0 1px 1px ";t.bind(this.__input,"keydown",function(e){if(e.keyCode===13){p.call(this)}});t.bind(this.__input,"blur",p);t.bind(this.__selector,"mousedown",function(e){t.addClass(this,"drag").bind(window,"mouseup",function(e){t.removeClass(f.__selector,"drag")})});var l=document.createElement("div");i.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"});i.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(this.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1});i.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1});i.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"});i.extend(l.style,{width:"100%",height:"100%",background:"none"});u(l,"top","rgba(0,0,0,0)","#000");i.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"});a(this.__hue_field);i.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"});t.bind(this.__saturation_field,"mousedown",c);t.bind(this.__field_knob,"mousedown",c);t.bind(this.__hue_field,"mousedown",function(e){m(e);t.bind(window,"mousemove",m);t.bind(window,"mouseup",d)});this.__saturation_field.appendChild(l);this.__selector.appendChild(this.__field_knob);this.__selector.appendChild(this.__saturation_field);this.__selector.appendChild(this.__hue_field);this.__hue_field.appendChild(this.__hue_knob);this.domElement.appendChild(this.__input);this.domElement.appendChild(this.__selector);this.updateDisplay()};s.superclass=e;i.extend(s.prototype,e.prototype,{updateDisplay:function(){var e=r(this.getValue());if(e!==false){var t=false;i.each(n.COMPONENTS,function(n){if(!i.isUndefined(e[n])&&!i.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n]){t=true;return{}}},this);if(t){i.extend(this.__color.__state,e)}}i.extend(this.__temp.__state,this.__color.__state);this.__temp.a=1;var s=this.__color.v<.5||this.__color.s>.5?255:0;var o=255-s;i.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+s+","+s+","+s+")"});this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px";this.__temp.s=1;this.__temp.v=1;u(this.__saturation_field,"left","#fff",this.__temp.toString());i.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+s+","+s+","+s+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})}});var o=["-moz-","-o-","-webkit-","-ms-",""];return s}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(e,t,n,r){function s(e,t,n){Object.defineProperty(e,t,{get:function(){if(this.__state.space==="RGB"){return this.__state[t]}u(this,t,n);return this.__state[t]},set:function(e){if(this.__state.space!=="RGB"){u(this,t,n);this.__state.space="RGB"}this.__state[t]=e}})}function o(e,t){Object.defineProperty(e,t,{get:function(){if(this.__state.space==="HSV")return this.__state[t];a(this);return this.__state[t]},set:function(e){if(this.__state.space!=="HSV"){a(this);this.__state.space="HSV"}this.__state[t]=e}})}function u(e,n,i){if(e.__state.space==="HEX"){e.__state[n]=t.component_from_hex(e.__state.hex,i)}else if(e.__state.space==="HSV"){r.extend(e.__state,t.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}else{throw"Corrupted color state"}}function a(e){var n=t.rgb_to_hsv(e.r,e.g,e.b);r.extend(e.__state,{s:n.s,v:n.v});if(!r.isNaN(n.h)){e.__state.h=n.h}else if(r.isUndefined(e.__state.h)){e.__state.h=0}}var i=function(){this.__state=e.apply(this,arguments);if(this.__state===false){throw"Failed to interpret color arguments"}this.__state.a=this.__state.a||1};i.COMPONENTS=["r","g","b","h","s","v","hex","a"];r.extend(i.prototype,{toString:function(){return n(this)},toOriginal:function(){return this.__state.conversion.write(this)}});s(i.prototype,"r",2);s(i.prototype,"g",1);s(i.prototype,"b",0);o(i.prototype,"h");o(i.prototype,"s");o(i.prototype,"v");Object.defineProperty(i.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}});Object.defineProperty(i.prototype,"hex",{get:function(){if(!this.__state.space!=="HEX"){this.__state.hex=t.rgb_to_hex(this.r,this.g,this.b)}return this.__state.hex},set:function(e){this.__state.space="HEX";this.__state.hex=e}});return i}(dat.color.interpret,dat.color.math=function(){var e;return{hsv_to_rgb:function(e,t,n){var r=Math.floor(e/60)%6;var i=e/60-Math.floor(e/60);var s=n*(1-t);var o=n*(1-i*t);var u=n*(1-(1-i)*t);var a=[[n,u,s],[o,n,s],[s,n,u],[s,o,n],[u,s,n],[n,s,o]][r];return{r:a[0]*255,g:a[1]*255,b:a[2]*255}},rgb_to_hsv:function(e,t,n){var r=Math.min(e,t,n),i=Math.max(e,t,n),s=i-r,o,u;if(i!=0){u=s/i}else{return{h:NaN,s:0,v:0}}if(e==i){o=(t-n)/s}else if(t==i){o=2+(n-e)/s}else{o=4+(e-t)/s}o/=6;if(o<0){o+=1}return{h:o*360,s:u,v:i/255}},rgb_to_hex:function(e,t,n){var r=this.hex_with_component(0,2,e);r=this.hex_with_component(r,1,t);r=this.hex_with_component(r,0,n);return r},component_from_hex:function(e,t){return e>>t*8&255},hex_with_component:function(t,n,r){return r<<(e=n*8)|t&~(255<<e)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}(),dat.dom.CenteredDiv=function(e,t){function r(e){console.log(e)}var n=function(){this.backgroundElement=document.createElement("div");t.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"});e.makeFullscreen(this.backgroundElement);this.backgroundElement.style.position="fixed";this.domElement=document.createElement("div");t.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"});document.body.appendChild(this.backgroundElement);document.body.appendChild(this.domElement);var n=this;e.bind(this.backgroundElement,"click",function(){n.hide()})};n.prototype.show=function(){var e=this;this.backgroundElement.style.display="block";this.domElement.style.display="block";this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)";this.layout();t.defer(function(){e.backgroundElement.style.opacity=1;e.domElement.style.opacity=1;e.domElement.style.webkitTransform="scale(1)"})};n.prototype.hide=function(){var t=this;var n=function(){t.domElement.style.display="none";t.backgroundElement.style.display="none";e.unbind(t.domElement,"webkitTransitionEnd",n);e.unbind(t.domElement,"transitionend",n);e.unbind(t.domElement,"oTransitionEnd",n)};e.bind(this.domElement,"webkitTransitionEnd",n);e.bind(this.domElement,"transitionend",n);e.bind(this.domElement,"oTransitionEnd",n);this.backgroundElement.style.opacity=0;this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)"};n.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-e.getWidth(this.domElement)/2+"px";this.domElement.style.top=window.innerHeight/2-e.getHeight(this.domElement)/2+"px"};return n}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common)